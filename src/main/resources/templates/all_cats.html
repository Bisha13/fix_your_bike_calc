<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>EasyRide calculator</title>
<!--    //TODO Сделать более приятный дизайн-->
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.panel').hide();
            $('.hiding-block').hide();
            });
    </script>

</head>
<body>

<style>
    .panel {
        padding: 0 18px;
        background-color: white;
        /*max-height: 0;*/
        overflow: hidden;
        transition: max-height 0.2s ease-out;
        margin: 5px;
    }

    .row div {
        display: inline-block;
        border: 1px solid blue;
        padding: 10px 5px;
    }

    .panel {
        width: 600px
    }

    .point {
        width: 600px
    }

    .price {
        width: 50px;
    }


</style>

<div sec:authorize="!isAuthenticated()">
    <li><a th:href="@{/login}">Sign in</a></li>
</div>
<div sec:authorize="isAuthenticated()">
    <li><a th:href="@{/logout}">Logout (<span sec:authentication="principal.username"/>)</a></li>
</div>
<fieldset>
    <container>
        <div class="category" th:each="cat : ${allCategoriesAtr}">
<!--            //TODO Более адекватный дизайн кнопки-->
            <h3 class="hide-button" th:text="${cat.name}"
                onclick="$(this).next().slideToggle('fast')"></h3>
            <div class="hiding-block">
                <div class="row" th:each="item : ${cat.items}">
                    <div>
                        <input type="checkbox" class="item-checkbox" th:value="${item.price}" onclick="calculate()">
                    </div>
                    <div class="point" th:text="${item.name}" onclick="$(this).siblings('.panel').slideToggle('fast')">

                    </div>
                    <div class="price" th:text="${item.price}">3000</div>

<!--                    //TODO прикрутить security-->
                    <div sec:authorize="hasAuthority('ROLE_ADMIN')">
                        <form th:method="get" th:action="@{/items/delete}">
                            <input type="hidden" th:value="${item.id}" th:name="itemId">
                            <button type="submit" value="Удалить"/>
                            Удалить</button>
                        </form>
                    </div>
                    <div sec:authorize="hasAuthority('ROLE_ADMIN')">
                        <form th:method="get" th:action="@{/items/update}">
                            <input type="hidden" th:value="${item.id}" th:name="itemId">
                            <input type="hidden" th:value="${item.category}">
                            <button type="submit" value="Изменить"/>
                            Изменить</button>
                        </form>
                    </div>

                    <p class="panel" th:text="${item.description}"></p>

                </div>
            </div>
        </div>
    </container>
</fieldset>


<br>
<p id="result">Сумма</p>
<br>


<script>
    function calculate() {
        let checkboxes = document.getElementsByTagName('input');
        let sum = 0;
        for (let index = 0; index < checkboxes.length; index++) {
            if (checkboxes[index].checked) {
                sum += parseInt(checkboxes[index].value);
                document.getElementById("result").innerHTML = 'Сумма: ' + sum + ' Рублей.';
            } else
                document.getElementById("result").innerHTML = 'Сумма: ' + sum + ' Рублей.';
        }
    }
</script>

</body>
</html>